val rawEmailArray = businessContactsMap.get(alertCode).map(_._2).getOrElse("")
println(s"DEBUG: Before match - rawEmailArray = $rawEmailArray, Type: ${rawEmailArray.getClass}")

val emailArray: Array[String] = rawEmailArray match {
  case arr: Array[_] =>
    arr.collect { case s: String => s }

  case list if list.isInstanceOf[java.util.List[_]] =>
    list.asInstanceOf[java.util.List[_]].asScala.collect { case s: String => s }.toArray

  case str if str.isInstanceOf[String] =>
    Array(str.asInstanceOf[String]) // âœ… Force cast to avoid type mismatch

  case _ =>
    Array.empty[String]
}

val emailAddress = emailArray.mkString(",") // Convert to comma-separated String
