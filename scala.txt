import scala.collection.JavaConverters._

businessContactsMap.get(alertCode) match {
  case Some((business, rawEmailArray, frequency: String)) if frequencyFilter.contains(frequency) =>
    
    val emailArray: Array[String] = 
      if (rawEmailArray == null) {
        Array.empty[String] // Handle null values safely
      } else if (rawEmailArray.getClass == classOf[String]) {
        Array(rawEmailArray.asInstanceOf[String]) // Convert single String to Array[String]
      } else if (rawEmailArray.getClass == classOf[java.util.List[_]]) {
        rawEmailArray.asInstanceOf[java.util.List[_]].asScala.toArray.map(_.toString)
      } else if (rawEmailArray.getClass.isArray) {
        rawEmailArray.asInstanceOf[Array[_]].map(_.toString)
      } else {
        Array.empty[String] // Handle unexpected types
      }

    val emailAddress = emailArray.mkString(",")

    // Debugging output
    println(s"DEBUG: rawEmailArray = $rawEmailArray, Type: ${Option(rawEmailArray).map(_.getClass).getOrElse("null")}")
    println(s"DEBUG: Final emailAddress = $emailAddress")
}
