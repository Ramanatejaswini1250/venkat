import java.io.{BufferedReader, FileReader}
import scala.collection.mutable.ListBuffer

val filePath = "/output/path/combined_master_table.csv"  // Path to your CSV file

// List to store the filtered rows for each alertCode
val filteredRowsByAlertCode = scala.collection.mutable.Map[String, ListBuffer[String]]()

// Create a BufferedReader to read the CSV file
val reader = new BufferedReader(new FileReader(filePath))

// Read the header first and discard it
val header = reader.readLine()  // Read and discard the header row

// Initialize a set to track unique alertCodes
val uniqueAlertCodes = scala.collection.mutable.Set[String]()

// Loop through each line (row) in the file and extract alertCodes
var line = reader.readLine()
while (line != null) {
  // Extract alertCode from each row (assuming alertCode is the first column)
  val alertCode = line.split(",")(0)  // Assuming the alertCode is in the first column

  // Add the alertCode to the set of unique alertCodes
  uniqueAlertCodes += alertCode

  // Initialize a list for each alertCode if not already present
  if (!filteredRowsByAlertCode.contains(alertCode)) {
    filteredRowsByAlertCode(alertCode) = ListBuffer[String]()
  }

  // Add the row to the corresponding alertCode list
  filteredRowsByAlertCode(alertCode) += line

  // Read the next line
  line = reader.readLine()
}

// Close the reader after reading the file
reader.close()

// Process each alertCode
uniqueAlertCodes.foreach { alertCode =>
  println(s"Filtered data for alertCode: $alertCode")
  filteredRowsByAlertCode(alertCode).foreach(println)
  val count = filteredRowsByAlertCode(alertCode).size
  println(s"Count for alertCode $alertCode: $count")
}
